# 一、进程和线程

## 1.1 进程

- 程序由指令和数据组成，但这些指令要运行，数据要读写，就必须将指令加载至CPU，数据加载至内存。在指令运行过程中还需要用到磁盘，网络等设备。进程就是来加载指令、管理内存、管理IO的
- 当一个程序运行，从磁盘加载这个程序的代码至内存，这时就开启了一个进程。
- 进程就可以视为程序的一个实例。大部分程序可以同时运行多个实例进程（例如记事本、画图）也有的程序只能启动一个实例进程（例如360）



## 1.2 线程

- 一个进程可以分为一到多个线程。
- 一个线程就是一个指令流，将指令流中的一条条指令以一定的顺序交给CPU执行
- Java中，线程作为最小的调度单位，进程作为资源分配的最小单位。在window中进程是不活动的，只是作为线程的容器。



## 1.3 二者对比

- 进程基本是相互独立，而线程存在于进程内，是进程的一个子集
- 进程拥有共享资源，如内存空间等，供其内部的线程共享
- 进程间通信较为复杂
  - 同一台计算机的进程通信成为IPC（Inter-process communication）
  - 不同计算机之间的进程通信，需要通过网络，并遵守协议例如HTTP
- 线程通信相对简单，因为它们共享进程内的内存，一个列子是多个线程可以访问同一个共享变量
- 线程更轻量，线程上下文切换成本一般比进程上下文切换低很多



# 二、并行和并发

## 2.1 并发

一个线程内有多个指令。

同一时间应对多件事情的能力叫做 **并发** 

单核CPU下，线程实际还是 **串行执行** 。操作系统中有一个组件叫做任务调度器，将cpu的时间片分给不同的线程使用，只是由于cpu在线程间的切换非常快。 **微观串行，宏观并行**

一般将这种 **线程轮流使用** CPU的做法叫做并发 concurrent





## 2.2 并行

现在CPU都是多核心，每个核心就能处理线程。

一个CPU多个核心，同时处理多个线程操作，叫做 **并行**



## 2.1 总结

- 并发 concurrent：同一时间**应对**多件事情的能力
- 并行 parallel：同一时间**动手**做多件事情



# 三、线程——异步调用

从方法调用的角度来讲：

- 需要等待结果返回，才能继续运行就是 **同步**
- 不需要等待结果返回，就能继续运行就是 **异步**

注意：**同步**在多线程中还有另外一个意思，是让多个线程步调一致



## 3.1 同步和异步的使用环境

- 项目中，视频文件需要转换格式等操作复杂比较费时间，这时开一个线程处理视频转换，避免阻塞主线程
- tomcat的异步servlet也是类似的目的。让用户线程处理耗时较长的操作，避免阻塞tomcat的工作线程
- IO操作不占用CPU，只是我们一般拷贝文件使用的是【阻塞IO】，这时相当于线程虽然不用cpu，但需要一直等待IO结束，没能充分利用线程。所有才有了 **NIO和BIO** 的优化



# 四、Thread和Runnable的关系

- Runnable更容易与线程池等高级API结合
- Runnable让任务类脱离了Thread继承体系，更灵活
- Thread将任务和线程结合在一块。Runnable将线程和任务分开



# 五、FutureTask配合Thread

FutureTask能够接受**Callable**类型的参数，用来处理有返回的结果情况



一般线程没有返回值，FutureTask可以有返回值

~~~java
//创建任务对象
FutureTask<Integer> task = new FutureTask<>(()->{
    log.debug("hello");
    return 100;
});

//参数1 是任务对象，参数2 是线程的名字
new Thread(task,"t3").start();

//主线程阻塞，同步等待 task 执行完毕的结果
Integer result = task.get();
~~~



# 六、线程调试工具

jconsole 用来调试线程





# 七、线程运行的原理

## 7.1 栈和栈帧 

Java Virtual Machine Stacks java虚拟机

JVM有栈、堆、方法区组成。其中栈内存是给谁用的？其实就是**线程** 每个线程启动后，虚拟机都会给其分配一块栈内存。

- 每个栈由多个栈帧（Frame）组成，对应着每次方法调用时所占用的内存。
- 每个线程只能有一个活动栈帧，对应着当前正在执行的那个方法。































































































